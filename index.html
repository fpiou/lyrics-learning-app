<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="./vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#667eea" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <link rel="manifest" href="./manifest.json" />
    <title>Apprentissage de Paroles</title>
    <style>
      /* CSS int√©gr√© avec toutes les am√©liorations modernes */
      
      /* Reset et base */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      /* Am√©lioration pour mobile - mais sans casser le desktop */
      button {
        -webkit-tap-highlight-color: transparent;
        cursor: pointer;
      }

      #app {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
      }

      /* Header */
      header {
        text-align: center;
        margin-bottom: 2rem;
        color: white;
      }

      header h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      }

      header p {
        font-size: 1.1rem;
        opacity: 0.9;
      }

      /* Sections */
      main {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      }

      section {
        margin-bottom: 2rem;
      }

      section:last-child {
        margin-bottom: 0;
      }

      /* Input Section */
      .input-section label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #555;
      }

      #lyrics-input {
        width: 100%;
        padding: 1rem;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        font-size: 1rem;
        font-family: inherit;
        resize: vertical;
        transition: border-color 0.3s ease;
      }

      #lyrics-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      /* Controls Section */
      .controls-section {
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: 10px;
      }

      .button-group {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
      }

      .primary-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        min-height: 44px; /* Am√©lioration mobile */
      }

      .primary-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .secondary-btn {
        background: #f8f9fa;
        color: #555;
        border: 2px solid #e1e5e9;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        min-height: 44px; /* Am√©lioration mobile */
      }

      .secondary-btn:hover {
        background: #e9ecef;
        border-color: #adb5bd;
      }

      /* Display Section */
      .display-section {
        position: relative;
      }

      .lyrics-container {
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        padding: 2rem;
        min-height: 300px;
        position: relative;
      }

      .placeholder-text {
        color: #6c757d;
        font-style: italic;
        text-align: center;
        margin-top: 50px;
      }

      /* Lyrics Display */
      .lyrics-line {
        margin-bottom: 1.5rem;
        padding: 1rem;
        border-radius: 8px;
        background: rgba(102, 126, 234, 0.05);
        transition: all 0.3s ease;
        opacity: 0.6; /* Toutes les lignes en opacit√© r√©duite par d√©faut */
        position: relative;
      }

      .lyrics-line:hover {
        background: rgba(102, 126, 234, 0.08);
      }

      .lyrics-line.current-line {
        border: 2px solid #667eea;
        background: rgba(102, 126, 234, 0.1);
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        opacity: 1 !important; /* Force l'opacit√© compl√®te pour la ligne courante */
        font-weight: 500;
      }

      .lyrics-line.completed-line {
        background: rgba(40, 167, 69, 0.05);
        border-left: 4px solid #28a745;
        /* Garde l'opacit√© r√©duite (0.6) d√©finie dans .lyrics-line */
      }

      .line-content {
        margin-bottom: 0.75rem;
        line-height: 1.6;
        display: block;
        width: 100%;
      }

      .word {
        display: inline-block;
        margin: 2px;
        padding: 2px 4px;
        border-radius: 4px;
        position: relative;
        transition: all 0.3s ease;
      }

      .word.hidden {
        background: #667eea;
        color: white;
        cursor: pointer;
        user-select: none;
        border-radius: 4px;
      }

      .word.hidden.clickable {
        cursor: pointer;
        background: #667eea;
      }

      .word.hidden.clickable:hover {
        background: #5a6fd8;
        transform: scale(1.05);
      }

      .word.revealed {
        background: #28a745;
        color: white;
        border-radius: 4px;
        padding: 2px 4px;
        animation: reveal 0.5s ease;
      }

      @keyframes reveal {
        0% {
          transform: scale(0.8);
          opacity: 0.5;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      .word-placeholder {
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        height: 0.9em;
        border-radius: 4px;
        display: inline-block;
        position: relative;
        top: -0.05em;
        min-width: 1ch;
        opacity: 0.8;
        cursor: pointer;
        transition: all 0.3s ease;
        vertical-align: baseline;
      }

      .word.clickable .word-placeholder:hover {
        opacity: 1;
        transform: scale(1.05);
      }

      /* Line Validation */
      .line-validation {
        display: flex;
        gap: 2rem;
        justify-content: center;
        margin-top: 0.75rem;
      }

      .validation-btn {
        padding: 0.5rem 1.5rem;
        border: none;
        border-radius: 25px;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 120px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }

      .validation-btn:hover {
        transform: translateY(-1px);
      }

      .success-btn {
        background: linear-gradient(135deg, #28a745, #20c997);
        color: white;
      }

      .success-btn:hover {
        background: linear-gradient(135deg, #20c997, #17a2b8);
        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
      }

      .fail-btn {
        background: linear-gradient(135deg, #dc3545, #c82333);
        color: white;
      }

      .fail-btn:hover {
        background: linear-gradient(135deg, #c82333, #a71e2a);
        box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
      }

      /* Progress Section */
      .progress-section {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        padding: 1.5rem;
        border-radius: 10px;
        display: none;
      }

      .progress-info {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 1rem;
      }

      .progress-info span {
        font-weight: 600;
        color: #495057;
      }

      /* Floating Progress Indicator */
      .floating-progress {
        position: fixed;
        top: 20px;
        right: 20px;
        background: white;
        border-radius: 15px;
        padding: 1rem;
        box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        display: flex;
        align-items: center;
        gap: 1rem;
        z-index: 1000;
        border: 3px solid #667eea;
      }

      .progress-circle {
        position: relative;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: conic-gradient(#667eea var(--progress-angle, 0deg), #e9ecef var(--progress-angle, 0deg));
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: #667eea;
        font-size: 0.9rem;
      }

      .progress-circle::before {
        content: '';
        position: absolute;
        width: 45px;
        height: 45px;
        background: white;
        border-radius: 50%;
      }

      .progress-circle span {
        position: relative;
        z-index: 1;
      }

      .progress-details {
        display: flex;
        flex-direction: column;
      }

      .progress-details span:first-child {
        font-weight: bold;
        color: #667eea;
      }

      .progress-label {
        font-size: 0.8rem;
        color: #6c757d;
      }

      /* Mobile Responsiveness */
      @media (max-width: 768px) {
        #app {
          padding: 10px;
        }

        main {
          padding: 1rem;
        }

        header h1 {
          font-size: 2rem;
        }

        .button-group {
          flex-direction: column;
        }

        .primary-btn, .secondary-btn {
          width: 100%;
        }

        .progress-info {
          flex-direction: column;
          text-align: center;
        }

        .floating-progress {
          position: fixed;
          top: 10px;
          right: 10px;
          padding: 0.75rem;
          width: auto;
          max-width: calc(100vw - 20px);
        }

        .progress-circle {
          width: 50px;
          height: 50px;
        }

        .progress-circle::before {
          width: 38px;
          height: 38px;
        }

        .progress-details {
          font-size: 0.9rem;
        }

        .lyrics-line {
          padding: 0.5rem;
        }

        .line-validation {
          display: flex;
          margin-left: 0;
          margin-top: 0.5rem;
          justify-content: center;
        }

        .validation-btn {
          width: 50px;
          height: 50px;
          font-size: 1.5rem;
        }
      }

      /* Am√©liorations pour l'accessibilit√© */
      @media (prefers-reduced-motion: reduce) {
        * {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* Optimisation pour les √©crans tactiles */
      @media (pointer: coarse) {
        .word.hidden.clickable {
          min-height: 44px;
          min-width: 44px;
          display: inline-flex;
          align-items: center;
          justify-content: center;
        }
      }
    </style>
  </head>
  <body>
    <div id="app">
      <header>
        <h1>üìö Apprentissage de Paroles</h1>
        <p>Apprenez vos chansons pr√©f√©r√©es en cachant progressivement les mots</p>
      </header>
      
      <main>
        <section class="input-section">
          <label for="lyrics-input">Collez vos paroles ici :</label>
          <textarea 
            id="lyrics-input" 
            placeholder="Collez les paroles de votre chanson ici..."
            rows="8"
          >La Cigale, ayant chant√©
Tout l'√©t√©,
Se trouva fort d√©pourvue
Quand la bise fut venue :
Pas un seul petit morceau
De mouche ou de vermisseau.
Elle alla crier famine
Chez la Fourmi sa voisine,
La priant de lui pr√™ter
Quelque grain pour subsister
Jusqu'√† la saison nouvelle.
¬´ Je vous paierai, lui dit-elle,
Avant l'O√ªt, foi d'animal,
Int√©r√™t et principal.  ¬ª
La Fourmi n'est pas pr√™teuse :
C'est l√† son moindre d√©faut.
Que faisiez-vous au temps chaud ?
Dit-elle √† cette emprunteuse.
‚Äì Nuit et jour √† tout venant
Je chantais, ne vous d√©plaise.
‚Äì Vous chantiez ? j'en suis fort aise.
Eh bien! dansez maintenant.</textarea>
        </section>

        <section class="controls-section">
          <div class="button-group">
            <button id="start-learning" class="primary-btn">Commencer l'apprentissage</button>
            <button id="reset-button" class="secondary-btn">R√©initialiser</button>
          </div>
        </section>

        <section class="display-section">
          <div id="lyrics-display" class="lyrics-container">
            <p class="placeholder-text">Les paroles appara√Ætront ici une fois que vous aurez coll√© du texte et cliqu√© sur "Commencer l'apprentissage"</p>
          </div>
          
          <!-- Indicateur flottant de progression -->
          <div id="floating-progress" class="floating-progress" style="display: none;">
            <div class="progress-circle">
              <span id="floating-percentage">0%</span>
            </div>
            <div class="progress-details">
              <span id="floating-lines">0/0</span>
              <span class="progress-label">lignes</span>
            </div>
          </div>
        </section>

        <section class="progress-section">
          <div class="progress-info">
            <span>Lignes apprises : <span id="lines-completed">0</span></span>
            <span>Lignes totales : <span id="total-lines">0</span></span>
            <span>Niveau actuel : <span id="current-level">0% de la chanson apprise</span></span>
          </div>
        </section>
      </main>
    </div>

    <script>
      // JavaScript int√©gr√© avec toutes les am√©liorations modernes
      
      // Classe principale pour g√©rer l'application d'apprentissage de paroles
      class LyricsLearningApp {
        constructor() {
          this.lyrics = '';
          this.parsedLines = [];
          this.currentLineIndex = 0;
          this.isLearningMode = false;
          
          this.initializeElements();
          this.bindEvents();
        }

        // Optimisations mobiles simplifi√©es
        setupMobileOptimizations() {
          // Uniquement sur mobile : pr√©venir le zoom automatique sur iOS
          if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
            const inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
              if (input.style.fontSize === '' || parseFloat(input.style.fontSize) < 16) {
                input.style.fontSize = '16px';
              }
            });
          }
        }

        initializeElements() {
          this.lyricsInput = document.getElementById('lyrics-input');
          this.startButton = document.getElementById('start-learning');
          this.resetButton = document.getElementById('reset-button');
          this.lyricsDisplay = document.getElementById('lyrics-display');
          this.progressSection = document.querySelector('.progress-section');
          this.linesCompletedSpan = document.getElementById('lines-completed');
          this.totalLinesSpan = document.getElementById('total-lines');
          this.currentLevelSpan = document.getElementById('current-level');
          
          // √âl√©ments pour l'indicateur flottant
          this.floatingProgress = document.getElementById('floating-progress');
          this.floatingPercentage = document.getElementById('floating-percentage');
          this.floatingLines = document.getElementById('floating-lines');
        }

        bindEvents() {
          this.startButton.addEventListener('click', () => this.startLearning());
          this.resetButton.addEventListener('click', () => this.reset());
          
          // Appeler les optimisations mobiles apr√®s que les √©l√©ments soient initialis√©s
          this.setupMobileOptimizations();
        }

        startLearning() {
          const lyrics = this.lyricsInput.value.trim();
          if (!lyrics) {
            alert('Veuillez entrer des paroles de chanson');
            return;
          }

          this.lyrics = lyrics;
          this.parsedLines = this.parseText(lyrics);
          this.currentLineIndex = 0;
          this.isLearningMode = true;
          
          // Initialiser chaque ligne avec le dernier mot cach√©
          this.initializeLines();
          this.renderLyrics();
          this.updateProgress();
          this.progressSection.style.display = 'block';
          this.floatingProgress.style.display = 'flex';
          this.scrollToCurrentLine();
        }

        parseText(text) {
          const lines = text.split('\n').filter(line => line.trim() !== '');
          return lines.map((line, lineIndex) => {
            const words = [];
            const parts = line.split(/(\s+)/);
            
            for (const part of parts) {
              if (part.trim() === '') {
                words.push({ type: 'space', content: part });
              } else {
                // Regex am√©lior√© pour les caract√®res fran√ßais (lettres, chiffres, apostrophes, traits d'union, accents)
                const match = part.match(/^([^\p{L}\p{N}'''-]*)([\p{L}\p{N}'''-]+)([^\p{L}\p{N}'''-]*)$/u);
                if (match) {
                  const [, prefix, word, suffix] = match;
                  if (prefix) words.push({ type: 'punctuation', content: prefix });
                  if (word) words.push({ type: 'word', content: word, hidden: false, revealed: false });
                  if (suffix) words.push({ type: 'punctuation', content: suffix });
                } else {
                  // Si le regex ne match pas, traiter comme ponctuation pure
                  words.push({ type: 'punctuation', content: part });
                }
              }
            }
            
            const wordElements = words.filter(w => w.type === 'word');
            
            return {
              words,
              wordElements,
              hiddenCount: wordElements.length > 0 ? 1 : 0, // Commencer avec 1 mot cach√© (le dernier)
              isCompleted: false,
              hasValidationButtons: false,
              hasBeenRevealed: false, // Nouvelle propri√©t√© pour tracker si la ligne a √©t√© r√©v√©l√©e
              isLearned: false // Nouvelle propri√©t√© pour tracker si la ligne est apprise (tous mots cach√©s + trouv√©)
            };
          });
        }

        initializeLines() {
          this.parsedLines.forEach((line, lineIndex) => {
            this.applyHiddenWordsToLine(lineIndex);
          });
        }

        applyHiddenWordsToLine(lineIndex) {
          const line = this.parsedLines[lineIndex];
          const wordElements = line.wordElements;
          
          if (wordElements.length === 0) return;
          
          // R√©initialiser tous les mots
          wordElements.forEach(word => {
            word.hidden = false;
            word.revealed = false;
          });
          
          // Cacher les mots depuis la fin selon hiddenCount
          const wordsToHide = Math.min(line.hiddenCount, wordElements.length);
          for (let i = 0; i < wordsToHide; i++) {
            const wordIndex = wordElements.length - 1 - i;
            wordElements[wordIndex].hidden = true;
          }
        }

        renderLyrics() {
          if (!this.parsedLines.length) {
            this.lyricsDisplay.innerHTML = '';
            return;
          }

          const lyricsHTML = this.parsedLines.map((line, lineIndex) => {
            const isCurrentLine = lineIndex === this.currentLineIndex;
            const lineClasses = ['lyrics-line'];
            if (isCurrentLine) lineClasses.push('current-line');
            if (line.isCompleted) lineClasses.push('completed-line');

            const lineHTML = line.words.map(word => {
              if (word.type === 'word') {
                const classes = ['word'];
                if (word.hidden && !word.revealed) {
                  classes.push('hidden');
                  // Ajouter la classe clickable seulement pour la ligne courante
                  if (isCurrentLine) classes.push('clickable');
                }
                if (word.revealed) classes.push('revealed');
                
                let displayText = word.content;
                if (word.hidden && !word.revealed) {
                  // Cr√©er un cache avec la m√™me largeur que le mot original
                  // Utilise une estimation bas√©e sur la longueur du mot
                  const estimatedWidth = this.estimateWordWidth(word.content);
                  displayText = `<span class="word-placeholder" style="width: ${estimatedWidth}ch;"></span>`;
                }
                
                return `<span class="${classes.join(' ')}" data-word="${word.content}" data-line="${lineIndex}">${displayText}</span>`;
              }
              return word.content;
            }).join('');

            // Ajouter les boutons de validation seulement si la ligne a √©t√© r√©v√©l√©e
            let validationHTML = '';
            if (this.isLearningMode && isCurrentLine && line.hasValidationButtons) {
              validationHTML = `
                <div class="line-validation" data-line="${lineIndex}">
                  <button class="validation-btn fail-btn" data-action="not-found" title="Je n'ai pas trouv√©">üëé</button>
                  <button class="validation-btn success-btn" data-action="found" title="J'ai trouv√©">üëç</button>
                </div>
              `;
            }

            return `
              <div class="${lineClasses.join(' ')}" data-line="${lineIndex}">
                <div class="line-content">${lineHTML}</div>
                ${validationHTML}
              </div>
            `;
          }).join('');

          this.lyricsDisplay.innerHTML = lyricsHTML;

          // Attacher les √©v√©nements aux mots cliquables de la ligne courante
          this.lyricsDisplay.querySelectorAll('.word.clickable, .word.clickable .word-placeholder').forEach(element => {
            element.addEventListener('click', (e) => {
              // Si on clique sur le placeholder, trouver le span parent qui contient les donn√©es
              const wordElement = e.target.closest('.word[data-line]');
              if (wordElement) {
                this.revealLineWords({ target: wordElement });
              }
            });
          });

          // Attacher les √©v√©nements aux boutons de validation
          this.lyricsDisplay.querySelectorAll('.validation-btn').forEach(btn => {
            btn.addEventListener('click', (e) => this.handleValidation(e));
          });
        }

        revealLineWords(event) {
          const wordSpan = event.target;
          const lineIndex = parseInt(wordSpan.dataset.line);
          
          if (lineIndex !== this.currentLineIndex) return;
          
          const line = this.parsedLines[lineIndex];
          
          // Marquer que cette ligne a √©t√© r√©v√©l√©e (donc ne peut plus √™tre consid√©r√©e comme r√©ussie)
          line.hasBeenRevealed = true;
          
          // R√©v√©ler tous les mots cach√©s de cette ligne
          line.wordElements.forEach(word => {
            if (word.hidden) {
              word.revealed = true;
            }
          });
          
          // Afficher les boutons de validation
          line.hasValidationButtons = true;
          
          this.renderLyrics();
        }

        handleValidation(event) {
          const button = event.target;
          const lineIndex = parseInt(button.closest('.line-validation').dataset.line);
          const action = button.dataset.action;
          const line = this.parsedLines[lineIndex];

          if (action === 'found') {
            // V√©rifier si tous les mots √©taient cach√©s avant de dire "J'ai trouv√©"
            const allWordsWereHidden = line.hiddenCount >= line.wordElements.length;
            
            if (allWordsWereHidden) {
              // Marquer la ligne comme apprise
              line.isLearned = true;
            }
            
            // L'utilisateur a trouv√© : cacher un mot de plus (le pr√©c√©dent du premier cach√©)
            if (line.hiddenCount < line.wordElements.length) {
              line.hiddenCount++;
            }
          } else if (action === 'not-found') {
            // L'utilisateur n'a pas trouv√© : cacher un mot de moins (mais minimum 1)
            if (line.hiddenCount > 1) {
              line.hiddenCount--;
            }
          }

          // Marquer la ligne comme compl√©t√©e et passer √† la suivante
          line.isCompleted = true;
          line.hasValidationButtons = false;
          
          // Passer √† la ligne suivante
          this.moveToNextLine();
        }

        moveToNextLine() {
          this.currentLineIndex++;
          
          // Si on a fini toutes les lignes, revenir √† la premi√®re ligne
          if (this.currentLineIndex >= this.parsedLines.length) {
            this.currentLineIndex = 0;
            
            // R√©initialiser l'√©tat de completion pour le nouveau cycle
            this.parsedLines.forEach(line => {
              line.isCompleted = false;
            });
          }
          
          // V√©rifier si on a atteint 100% d'apprentissage (toutes les lignes apprises)
          const totalLines = this.parsedLines.length;
          const learnedLines = this.parsedLines.filter(line => line.isLearned).length;
          const linesPercentage = totalLines > 0 ? Math.round((learnedLines / totalLines) * 100) : 0;
          
          if (linesPercentage >= 100) {
            this.showCompletion();
            return;
          }
          
          // R√©appliquer les mots cach√©s pour toutes les lignes
          this.initializeLines();
          this.renderLyrics();
          this.updateProgress();
          
          // D√©filement automatique vers la nouvelle ligne courante
          setTimeout(() => {
            this.scrollToCurrentLine();
          }, 100); // Petit d√©lai pour que le rendu soit termin√©
        }

        estimateWordWidth(word) {
          // Estimation de la largeur en caract√®res (ch)
          // Prend en compte que certaines lettres sont plus larges que d'autres
          let width = 0;
          for (let char of word) {
            if ('iIl|!'.includes(char)) {
              width += 0.5; // Caract√®res √©troits
            } else if ('mMwW'.includes(char)) {
              width += 1.2; // Caract√®res larges
            } else {
              width += 1; // Caract√®res normaux
            }
          }
          return Math.max(width, 1); // Minimum 1ch
        }

        scrollToCurrentLine() {
          const currentLineElement = document.querySelector('.current-line');
          if (currentLineElement) {
            currentLineElement.scrollIntoView({
              behavior: 'smooth',
              block: 'center',
              inline: 'nearest'
            });
          }
        }

        updateProgress() {
          const totalLines = this.parsedLines.length;
          const learnedLines = this.parsedLines.filter(line => line.isLearned).length;
          const linesPercentage = totalLines > 0 ? Math.round((learnedLines / totalLines) * 100) : 0;
          
          // Mettre √† jour la section de progression principale
          this.linesCompletedSpan.textContent = learnedLines;
          this.totalLinesSpan.textContent = totalLines;
          
          // Mettre √† jour l'indicateur flottant
          this.floatingPercentage.textContent = `${linesPercentage}%`;
          this.floatingLines.textContent = `${learnedLines}/${totalLines}`;
          
          // Mettre √† jour l'angle du cercle de progression (CSS custom property)
          const progressAngle = (linesPercentage / 100) * 360;
          const progressCircle = document.querySelector('.progress-circle');
          if (progressCircle) {
            progressCircle.style.setProperty('--progress-angle', `${progressAngle}deg`);
          }
          
          if (this.currentLineIndex < totalLines) {
            const currentLine = this.parsedLines[this.currentLineIndex];
            this.currentLevelSpan.textContent = `${linesPercentage}% de la chanson apprise`;
          } else {
            this.currentLevelSpan.textContent = `${linesPercentage}% de la chanson apprise`;
          }
        }

        showCompletion() {
          setTimeout(() => {
            alert('F√©licitations ! Vous avez termin√© l\'apprentissage de cette chanson ! üéâ');
          }, 500);
        }

        reset() {
          this.lyrics = '';
          this.parsedLines = [];
          this.currentLineIndex = 0;
          this.isLearningMode = false;
          
          this.lyricsInput.value = '';
          this.lyricsDisplay.innerHTML = '<p class="placeholder-text">Les paroles appara√Ætront ici une fois que vous aurez coll√© du texte et cliqu√© sur "Commencer l\'apprentissage"</p>';
          this.progressSection.style.display = 'none';
          this.floatingProgress.style.display = 'none';
          
          this.updateProgress();
        }
      }

      // D√©marrer l'application
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          new LyricsLearningApp();
        });
      } else {
        new LyricsLearningApp();
      }
    </script>
  </body>
</html>
